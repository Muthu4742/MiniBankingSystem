<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Mini Bank - Dashboard</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="bg-light">
<nav class="navbar navbar-light bg-white shadow-sm">
<div class="container">
<span class="navbar-brand">Mini Banking System</span>
<div>
<span id="userName" class="me-3"></span>
<button id="logoutBtn" class="btn btn-outline-secondary btn-sm">Logout</button>
</div>
</div>
</nav>
<div class="container py-4">
<div class="row">
<div class="col-md-6">
<div class="card p-3 mb-3">
<h5>Balance</h5>
<div id="balance" class="fs-4">--</div>
<button id="refreshBtn" class="btn btn-sm btn-primary mt-2">Refresh</button>
</div>
<div class="card p-3 mb-3">
<h5>Deposit</h5>
<input id="depAmount" type="number" class="form-control mb-2" placeholder="Amount">
<button id="depBtn" class="btn btn-success">Deposit</button>
<div id="depMsg" class="mt-2"></div>
</div>
<div class="card p-3 mb-3">
<h5>Withdraw</h5>
<input id="wdAmount" type="number" class="form-control mb-2" placeholder="Amount">
<button id="wdBtn" class="btn btn-warning">Withdraw</button>
<div id="wdMsg" class="mt-2"></div>
</div>
</div>
<div class="col-md-6">
<div class="card p-3 mb-3">
<h5>Transaction History</h5>
<ul id="txList" class="list-group"></ul>
</div>
</div>
</div>
</div>

<script>
const accountId = sessionStorage.getItem('accountId');
const email = sessionStorage.getItem('email');
const name = sessionStorage.getItem('name')||'';
if(!accountId || !email) window.location.href='index.html';
document.getElementById('userName').innerText = name || email;

async function refreshBalance(){
const res = await fetch('/api/account/balance?email='+encodeURIComponent(email));
if(res.ok){ const data = await res.json(); document.getElementById('balance').innerText = '₹'+data.balance; }
}

async function loadTransactions(){
const res = await fetch('/api/account/transactions?accountId='+encodeURIComponent(accountId));
if(res.ok){
const tx = await res.json();
const list = document.getElementById('txList');
list.innerHTML = '';
tx.forEach(t=>{ const li = document.createElement('li'); li.className='list-group-item'; li.innerText=t.timestamp.replace('T',' ')+' - '+t.type+' - ₹'+t.amount; list.appendChild(li); });
}
}

document.getElementById('refreshBtn').addEventListener('click', ()=>{refreshBalance(); loadTransactions();});
document.getElementById('depBtn').addEventListener('click', async ()=>{
const amount = document.getElementById('depAmount').value;
const res = await fetch('/api/account/deposit', {method:'POST', headers:{'Content-Type':'application/json'}, body:JSON.stringify({email,amount})});
document.getElementById('depMsg').innerText = res.ok ? 'Deposited' : 'Failed'; refreshBalance(); loadTransactions();
});
document.getElementById('wdBtn').addEventListener('click', async ()=>{
const amount = document.getElementById('wdAmount').value;
const res = await fetch('/api/account/withdraw', {method:'POST', headers:{'Content-Type':'application/json'}, body:JSON.stringify({email,amount})});
document.getElementById('wdMsg').innerText = res.ok ? 'Withdrawn' : 'Failed'; refreshBalance(); loadTransactions();
});
document.getElementById('logoutBtn').addEventListener('click', ()=>{sessionStorage.clear(); window.location.href='index.html';});

refreshBalance(); loadTransactions();
</script>
</body>
</html>
